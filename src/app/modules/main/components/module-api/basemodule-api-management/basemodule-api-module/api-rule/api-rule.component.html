<!--
<p-toast />
<app-breadcrumbs id="section" *ngIf="!rulConditionFlag"></app-breadcrumbs>
<div class="grid flex-column">
    <p-panel header="{{'قواعد سرویس' | transloco}}" *ngIf="!rulConditionFlag&&!addFlag&&!updateFlag">
        <div class="grid grid-cols-12">
            <div class="col-4">
                <label class="normal-label"> <span transloco dir="rtl">عنوان سرویس</span> : </label><br>
                <div class="lblDetailsRight" [style.width.%]="widthName"
                     [pTooltip]="name"
                     [tooltipDisabled]="name?name.length < 20:false">
                    <label class="text-gray-700 ftextDetails">{{name|moreChar19}}</label>
                </div>
            </div>
            <div class="col-4">
                <label class="normal-label"> <span transloco dir="rtl">نام سرویس</span> : </label><br>
                <div class="lblDetailsRight" [style.width.%]="widthTitle"
                     [pTooltip]="title"
                     [tooltipDisabled]="title?title.length < 20:false">
                    <label class="text-gray-700 ftextDetails">{{title|moreChar19}}</label>
                </div>
            </div>
        </div>
        <div class="col-12" *ngIf="!addFlag&&!updateFlag">
            <button pButton label="{{'اتصال سرویس به قاعده' | transloco}}"
                    (click)="showRules()" [disabled]="attachFlag"
                    icon="pi pi-link "></button>
        </div>
        <p-table [value]="rulList" *ngIf="!addFlag&&!updateFlag" selectionMode="single">
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="row" class="row" >
                        table.header.row
                        <p-sortIcon field="row"></p-sortIcon>
                    </th>
                    <th pSortableColumn="name" class="name" >
                        نام
                        <p-sortIcon field="name"></p-sortIcon>
                    </th>
                    <th pSortableColumn="ruleTemplate" class="ruleTemplate" >
                        قالب
                        <p-sortIcon field="ruleTemplate"></p-sortIcon>
                    </th>
                    <th pSortableColumn="status" class="status" >
                        وضعیت
                        <p-sortIcon field="status"></p-sortIcon>
                    </th>
                    <th style="text-align: right !important;border-right: 1px solid #ebe8e8;" >operation</th>
                </tr>
            </ng-template>
            <ng-template let-i="rowIndex" pTemplate="body" let-roule>
                <tr [pSelectableRow]="roule">
                    <td class="row">{{roule.row}}</td>
                    <td class="name">{{roule.name}}</td>
                    <td class="ruleTemplate">{{roule.ruleTemplate|formatRule}}</td>
                    <td class="status" [ngStyle]="{'text-align': 'center !important'}">
                        <div [ngStyle]="{ 'border-radius':' 2.5px','color':roule.status == true ?
                         '#258F30' :'#962515',
                         'background-color': roule.status == false ?'#F18B7D' : '#85DC8F',
                         'width':'45px','margin':' 0 auto'}">
                            {{roule.status|statusPipe}}</div>
                    </td>
                    <td class="text-right border-r border-[#ebe8e8]" >
                        <button (click)="setRecord(roule)" type="button" class="p-button-rounded  " pButton
                                pRipple icon="pi pi-chevron-down" (click)="menu.toggle($event)"></button>&nbsp;
                        <p-menu appendTo="body" #menu [popup]="true" [model]="items"></p-menu>
                    </td>
                </tr>
            </ng-template>
        </p-table>


        <div class="col-12" dir="ltr" *ngIf="!addFlag&&!updateFlag">
            <button (click)="BeforeButton()"
                    style="width: 30px!important;" pButton
                    class="btn-warning p-button-warning" icon="pi pi-arrow-right"
                    matTooltip="{{'بازگشت' | transloco}}"></button>
        </div>
    </p-panel>
    <div class="col-12" *ngIf="addFlag">
        <app-api-rule-register (close)="onClose($event)"></app-api-rule-register>
    </div>
    <div class="col-12" *ngIf="updateFlag">
        <app-api-rule-update [inputUpdate]="ruleDto" (close)="onClose($event)"></app-api-rule-update>
    </div>
    <div class="col-12" *ngIf="rulConditionFlag">
        <app-api-rule-condition [inputApiRule]="ruleDto" (close)="onClose($event)"></app-api-rule-condition>
    </div>
</div>


<p-dialog [style]="{'width':'60%'}" [(visible)]="dialogRuleFlag"
          [modal]="true" [draggable]="false"
          [resizable]="true" appendTo="body">
    <p-panel header="{{'انتخاب قاعده' | transloco}}">
        <div class="grid grid-cols-12">
            <div class="col-4">
                <label class="normal-label"> <span >نام قاعده :</span></label><br>
                <input [(ngModel)]="ruleName"
                       pInputText>
            </div>
            &lt;!&ndash;(keydown.enter)="onKeydownSearch($event)"&ndash;&gt;
            <div class="col-4"></div>
            <div class="col-4" dir="ltr">
                <button pButton label="{{'button.search' | transloco}}" style="width: 110px;margin: 6px"
                        class="normal-button" icon="pi pi-search" (click)="showRules()"></button>&nbsp;&nbsp;
                <button pButton label="{{'button.clear'|transloco}}"
                        class="my-1 px-4 py-2 border normal-button" [outlined]="true"
                        icon="pi pi-filter-slash"
                        style="margin: 6px" (click)="clear()"></button>
            </div>

            <div class="col-4"></div>
            <div class="col-4"></div>
            <div class="col-12">
                <p-card>
                    <p-table [value]="ruleAttachList" selectionMode="single"
                             [paginator]="true" [rows]="rows" [showCurrentPageReport]="true" [(first)]="first"
                             [currentPageReportTemplate]=paginationLabel
                             [rowsPerPageOptions]="[5,10,25,50,100]">
                        <ng-template pTemplate="header">
                            <tr>
                                <th class="row" >table.header.row</th>
                                <th >نام قاعده</th>
                                <th >قالب</th>
                                <th >کد خطای عمومی</th>
                                <th >operation</th>
                            </tr>
                        </ng-template>
                        <ng-template let-i="rowIndex" pTemplate="body" let-rule>
                            <tr [pSelectableRow]="rule">
                                <td class="row">{{i + 1}}</td>
                                <td
                                    [pTooltip]="rule.name"
                                    [tooltipDisabled]="rule.name?
                                    rule.name.length < 20:false"
                                >
                                    {{rule.name|moreChar19}}
                                </td>
                                <td
                                    [pTooltip]="rule.ruleTemplate"
                                    [tooltipDisabled]="rule.ruleTemplate?
                                    rule.ruleTemplate.toString().length < 20:false"
                                >
                                    {{rule.ruleTemplate|ruleTemplate}}
                                </td>
                                <td>{{rule.httpsstatus}}</td>

                                <td dir="ltr">
                                    <button pButton label="انتخاب قاعده" icon="pi pi-check"
                                            (click)="selectedRule(rule)"></button>&nbsp;
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-card>
            </div>
        </div>
    </p-panel>
</p-dialog>
-->
<p-toast></p-toast>

<app-breadcrumbs id="section" *ngIf="!rulConditionFlag&& !addFlag && !updateFlag" (backClicked)="BeforeButton()"></app-breadcrumbs>

<div   class="content-page" *ngIf="!rulConditionFlag && !addFlag && !updateFlag">

        <div class="grid grid-cols-12 gap-4 ">
            <div class="col-span-4">
                <label class="normal-label">
                    <span  dir="rtl">{{'apiRule.label.apiName'|transloco}}</span> :
                </label>
                <div class="text-right" [style.width.%]="widthName"
                     [pTooltip]="name"
                     [tooltipDisabled]="name ? name.length < 20 : false">
                    <label class="text-gray-700 block truncate">{{ name | moreChar19 }}</label>
                </div>
            </div>

            <div class="col-span-4">
                <label class="normal-label">
                    <span  dir="rtl">{{ 'apiRule.label.apiTitle' |transloco}}</span> :
                </label>
                <div class="text-right" [style.width.%]="widthTitle"
                     [pTooltip]="title"
                     [tooltipDisabled]="title ? title.length < 20 : false">
                    <label class="text-gray-700 block truncate">{{ title | moreChar19 }}</label>
                </div>
            </div>
        </div>

        <div class="col-span-12 my-4" *ngIf="!addFlag && !updateFlag">
            <button pButton label="{{'apiRule.btn.attachApiRule' | transloco}}"
                    (click)="showRules()" [disabled]="attachFlag" class="normal-button"
                    icon="pi pi-link"></button>
        </div>

        <p-table [value]="rulList" *ngIf="!addFlag && !updateFlag" selectionMode="single">
            <ng-template pTemplate="header">
                <tr>
                    <th  class="row" >
                        {{ 'apiRule.table.th.row'|transloco }}
                    </th>
                    <th  class="name">
                        {{ 'apiRule.table.th.name'|transloco }}
                    </th>
                    <th  class="ruleTemplate">
                        {{ 'apiRule.table.th.ruleTemplate'|transloco }}
                    </th>
                    <th  class="status">
                        {{ 'apiRule.table.th.status'|transloco }}
                    </th>
                    <th class="text-right border-r border-gray-200">
                        {{ 'apiRule.table.th.operation'|transloco }}

                    </th>
                </tr>
            </ng-template>

            <ng-template let-i="rowIndex" pTemplate="body" let-roule>
                <tr [pSelectableRow]="roule">
                    <td>{{ roule.row }}</td>
                    <td>{{ roule.name }}</td>
                    <td>{{ roule.ruleTemplate | formatRule }}</td>
                    <td>
                        <div      [ngClass]="{
                                 ' text-green-800 bg-green-300 ': roule.status,
                                   ' text-red-800 bg-red-300 ': !roule.status
                                   }"
                                  class="w-[65px] float-right text-center rounded-md"
                        >
                            {{ roule.status | statusPipe }}
                        </div>
                    </td>
                    <td class="text-right border-r border-gray-200">
                        <button (click)="setRecord(roule)" pButton pRipple icon="pi pi-chevron-down"
                                class="p-button-rounded " (click)="menu.toggle($event)"></button>
                        <p-menu appendTo="body" #menu [popup]="true" [model]="items"></p-menu>
                    </td>
                </tr>
            </ng-template>
        </p-table>

    <!--</p-panel>-->
</div>
<div class="col-span-12" *ngIf="addFlag">
    <app-api-rule-register (close)="onClose($event)"></app-api-rule-register>
</div>
<div class="col-span-12" *ngIf="updateFlag">
    <app-api-rule-update [inputUpdate]="ruleDto" (close)="onClose($event)"></app-api-rule-update>
</div>
<div class="col-span-12" *ngIf="rulConditionFlag">
    <app-api-rule-condition [inputApiRule]="ruleDto" (close)="onClose($event)"></app-api-rule-condition>
</div>
<p-dialog [style]="{'width':'60%'}" [(visible)]="dialogRuleFlag"
          [modal]="true" [draggable]="false" [resizable]="true" appendTo="body">
    <p-panel header="{{'apiRule.dialog.header.selectRule' | transloco}}">
        <div   class="content-page">
        <div class="grid grid-cols-12 gap-4">
            <div class="col-span-4">
                <label class="normal-label">{{'apiRule.dialog.label.selectRule'|transloco}} :</label>
                <input [(ngModel)]="ruleName" pInputText class="w-full mt-1" />
            </div>

            <div class="col-span-4"></div>

            <div class="col-span-4 justify-start items-center gap-4 h-12 mt-5-5 rtl:flex-row-reverse" dir="ltr">
                <button pButton
                        label="{{'button.clear' | transloco}}"
                        icon="pi pi-filter-slash"
                        (click)="clear()"
                        [outlined]="true"
                        class="my-1 px-4 py-2 border normal-button"
                ></button>&nbsp;
                <button pButton
                        label="{{'button.search' | transloco}}"
                        icon="pi pi-search"
                        class="w-[110px] my-1 px-4 py-2 text-white normal-button"
                        (click)="showRules()"></button>
            </div>

            <div class="col-span-12">
                <p-card>
                    <p-table [value]="ruleAttachList" selectionMode="single"
                             [paginator]="true" [rows]="rows" [showCurrentPageReport]="true" [(first)]="first"
                             [currentPageReportTemplate]="paginationLabel"
                             [rowsPerPageOptions]="[5,10,25,50,100]">
                        <ng-template pTemplate="header">
                            <tr>
                                <th  pSortableColumn="row">
                                    <p-sortIcon field="row"></p-sortIcon>
                                    {{'apiRule.table.th.row'|transloco}}
                                </th>
                                <th  pSortableColumn="name">
                                    <p-sortIcon field="name"></p-sortIcon>
                                 {{'apiRule.table.th.ruleName'|transloco}}
                                </th>
                                <th  pSortableColumn="ruleTemplate">
                                     <p-sortIcon field="ruleTemplate"></p-sortIcon>
                                 {{'apiRule.table.th.ruleTemplate'|transloco}}
                                </th>
                                <th  pSortableColumn="httpsstatus">
                                     <p-sortIcon field="httpsstatus"></p-sortIcon>
                                 {{'apiRule.table.th.httpsStatus'|transloco}}
                                </th>
                                <th>
                                 {{'apiRule.table.th.operation'|transloco}}
                                </th>
                            </tr>
                        </ng-template>

                        <ng-template let-i="rowIndex" pTemplate="body" let-rule>
                            <tr [pSelectableRow]="rule">
                                <td>{{ i + 1 }}</td>
                                <td [pTooltip]="rule.name" [tooltipDisabled]="rule.name?.length < 20">
                                    {{ rule.name | moreChar19 }}
                                </td>
                                <td [pTooltip]="rule.ruleTemplate" [tooltipDisabled]="rule.ruleTemplate?.toString().length < 20">
                                    {{ rule.ruleTemplate | ruleTemplate }}
                                </td>
                                <td>{{ rule.httpsstatus }}</td>
                                <td dir="ltr">
                                    <button pButton label="{{'button.selectedRule'|transloco}}" icon="pi pi-check"
                                            class="normal-button" (click)="selectedRule(rule)"></button>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </p-card>
            </div>
        </div>
        </div>
    </p-panel>
</p-dialog>
