<div class="grid flex-column" id="section">
    <p-panel header="{{headerWage}}">
        <div class="grid grid-cols-12">
            <div class="col-12 detailCategory">
                <!--  <label class="normal-label"> <span >دسته بندی کارمزد :</span></label><br>-->
                <div  disabled>

                    {{titleCategory01}}
                    <span [ngStyle]="{ 'color': '#7229a9'}"
                    >{{"(" + (fromDate|castToDate) + ")"}}
                    </span>
                </div>
                <div  disabled>
                    &#8592;
                    {{titleCategory02}}
                    <span [ngStyle]="{ 'color': '#7229a9'}"
                    >{{"(" + (toDate|castToDate) + ")"}}
                    </span>
                </div>
                <div disabled>
                    &#8592;
                    {{titleCategory1}}
                    <span [ngStyle]="{ 'color': '#7229a9'}"
                          [pTooltip]="partyTitle"
                          [tooltipDisabled]="partyTitle?partyTitle.length < 19:false"
                    >{{"(" + partyTitle + ")"|threeDotBreadcrumbPipe}}
                    </span>
                </div>
                <div *ngIf="clientFlag" disabled>
                    &#8592;
                    {{titleCategory2}}
                    <span [ngStyle]="{ 'color': '#7229a9'}"
                          [pTooltip]="clientTitle"
                          [tooltipDisabled]="clientTitle?clientTitle.length < 19:false"
                    >{{"(" + clientTitle + ")"|threeDotBreadcrumbPipe}}
                    </span>
                </div>
                <div (click)="openDialog()">
                    &#8592;
                    <span [ngStyle]="{ 'color': '#37A1FF'}"> {{countApiTitle}}</span>
                    <span [ngStyle]="{ 'color': '#7229a9'}"
                    >{{"(" + countApi + ")"}}
                    </span>
                </div>
            </div>
            <div class="col-8">
                <label class="normal-label">
<span class="red-color-text">* </span>
<span >title :</span></label><br>
                <input pInputText [(ngModel)]="feeTitle" class="input-w-82-2"
                       [disabled]="disableUpdateFlag" (keydown.enter)="onKeydown($event)"
                       [maxLength]="wageConstants.wageTitleMaxLength">
            </div>
            <div class="p-col-4"></div>
         <!--   <div class="p-col-4">
                <label class="normal-label">
<span class="red-color-text">* </span>
<span >تاریخ شروع :</span></label><br>
                <p-persian-calendar class="app-persian-calendar-w89" [yearRange]="'1399:1410'"
                                    [(ngModel)]="fromDate" [disabled]="disableUpdateFlag">
                </p-persian-calendar>
            </div>
            <div class="p-col-4">
                <label class="normal-label">
<span class="red-color-text">* </span>
<span >تاریخ پایان :</span></label><br>
                <p-persian-calendar class="app-persian-calendar-w89" [yearRange]="'1399:1410'"
                                    [(ngModel)]="toDate" [disabled]="disableUpdateFlag">
                </p-persian-calendar>
            </div>
            <div class="col-4"></div>-->
            <div class="col-4">
                <label class="normal-label">
<span class="red-color-text">* </span>
<span >wage.type :</span></label><br>
                <p-dropdown optionValue="id"
                            appendTo='body'
                            optionLabel="name"
                            [(ngModel)]="feeTypeId"
                            [options]="wageConstants.wageTypeList"
                            [disabled]="disableUpdateFlag"
                            (onChange)="onChangeWageType()">
                </p-dropdown>
                <button pButton icon="pi pi-question-circle" class="p-button-warning"
                        (click)="helpFlag=true"  style="height: 22px; width: 22px;margin-bottom: 5px"></button>
            </div>
            <!--<div class="col-span-2">
                <label class="normal-label"> <span >وضعیت :</span></label><br>
                <p-inputSwitch [(ngModel)]="status"></p-inputSwitch>
            </div>-->
        </div>

        <p-panel header="{{'جزئیات کارمزد' | transloco}}">
            <div class="grid grid-cols-12">
                <div class="col-4" *ngIf="!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >نوع محاسبه :</span></label><br>
                    <p-dropdown optionValue="id" appendTo='body'
                                optionLabel="name"
                                [(ngModel)]="calculationTypeId"
                                [options]="calculationTypeOptions"
                                [disabled]="disableUpdateFlag"
                                (onChange)="onPercentageOrFixedAmount($event)">
                    </p-dropdown>
                </div>
                <div class="col-4" *ngIf="isPercentage&&!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >درصد :</span></label><br>
                    <input [disabled]="disableUpdateFlag||nullFeeFieldPath" (keydown.enter)="onKeydownDetail($event)"
                           [(ngModel)]="calculationValue" pInputText pKeyFilter="num">

                </div>
                <div class="col-4" *ngIf="!isPercentage&&!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >مبلغ ثابت :</span></label><br>
                    <!--<amount-box [(ngModel)]="calculationValue" (keydown.enter)="onKeydownDetail($event)"
                                [disabled]="disableUpdateFlag||nullFeeFieldPath"></amount-box>-->
                </div>
                <div class="col-4" *ngIf="wageTypeFlag&&!wageTedadiFlag&&!sadehFlag&&!disableUpdateFlag"></div>

                <div class="col-4" *ngIf="wageTypeFlag&&!wageTedadiFlag&&!sadehFlag&&!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >از مبلغ :</span></label><br>
                    <!--<amount-box (onBlur)="handleMaxAndMinAmount()" [(ngModel)]="fromValue"
                                [disabled]="disableUpdateFlag||nullFeeFieldPath" (keydown.enter)="onKeydownDetail($event)"></amount-box>-->
                </div>
                <div class="col-4" *ngIf="wageTypeFlag&&!wageTedadiFlag&&!sadehFlag&&!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >تا مبلغ :</span></label><br>
                    <!--<amount-box (onBlur)="handleMaxAndMinAmount()" [(ngModel)]="toValue"
                                [disabled]="disableUpdateFlag||nullFeeFieldPath" (keydown.enter)="onKeydownDetail($event)"></amount-box>-->
                </div>
                <div class="col-4" *ngIf="wageTedadiFlag&&!disableUpdateFlag"></div>
                <div class="col-4" *ngIf="wageTedadiFlag&&!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >از تعداد :</span></label><br>
                    <!--<amount-box [(ngModel)]="fromValue"
                                [disabled]="disableUpdateFlag||nullFeeFieldPath" (keydown.enter)="onKeydownDetail($event)"></amount-box>-->
                </div>
                <div class="col-4" *ngIf="wageTedadiFlag&&!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >تا تعداد :</span></label><br>
                    <amount-box [(ngModel)]="toValue" (keydown.enter)="onKeydownDetail($event)"
                                [disabled]="disableUpdateFlag||nullFeeFieldPath"></amount-box>
                </div>
                <div class="col-4" *ngIf="!disableUpdateFlag"></div>
                <div class="col-4" *ngIf="!disableUpdateFlag">
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >حداقل مبلغ کارمزد :</span></label><br>
                    <amount-box [(ngModel)]="minValue" (keydown.enter)="onKeydownDetail($event)"
                                [disabled]="disableUpdateFlag||nullFeeFieldPath"></amount-box>
                </div>
                <div class="col-4"*ngIf="!disableUpdateFlag" >
                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >حداکثر مبلغ کارمزد :</span></label><br>
                    <amount-box [(ngModel)]="maxvalue" (keydown.enter)="onKeydownDetail($event)"
                                [disabled]="disableUpdateFlag||nullFeeFieldPath"></amount-box>
                </div>

                <!--                <div class="col-4" *ngIf="wageTedadiFlag">
                                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >حداقل تعداد :</span></label><br>
                                    <amount-box [(ngModel)]="minValue"></amount-box>
                                </div>
                                <div class="col-4" *ngIf="wageTedadiFlag">
                                    <label class="normal-label">
<span class="red-color-text">* </span>
<span >حداکثر تعداد :</span></label><br>
                                    <amount-box [(ngModel)]="maxvalue"></amount-box>-->
                <!--                </div>-->
                <div class="col-4" hidden *ngIf="!disableUpdateFlag">
                    <input pInputText [(ngModel)]="temp" disabled>
                </div>
                <div class="col-4" *ngIf="!disableUpdateFlag"></div>
                <div class="col-4" *ngIf="!disableUpdateFlag">
                    <p-button
                        label="{{'افزودن' | transloco}}"
                        [icon]="'pi pi-plus'" [disabled]="disableUpdateFlag||sadehDonFlag"
                        (onClick)="addWageDetail()" *ngIf="showAddBtn&&!disableUpdateFlag"></p-button>&nbsp;
                    <p-button
                        label="{{'ویرایش' | transloco}}"
                        [icon]="'pi pi-pencil'" [disabled]="disableUpdateFlag"
                        (onClick)="updateWage()" *ngIf="!showAddBtn&&!disableUpdateFlag"></p-button>&nbsp;
                    <button pButton [outlined]="true"
                            label="{{'button.cancel' | transloco}}"
                             severity="danger"  icon="pi pi-times" [disabled]="disableUpdateFlag"
                            (click)="clearDetail()" *ngIf="!showAddBtn&&!disableUpdateFlag"></button>&nbsp;
                </div>
                <div class="col-4" *ngIf="!disableUpdateFlag"></div>
                <div class="col-4" *ngIf="!disableUpdateFlag"></div>
                <div class="col-12">
                    <p-table [value]="wageDetailList">
                        <ng-template pTemplate="header">
                            <tr>
                                <th >table.header.row</th>
                                <th >عنوان</th>
                                <th >نوع کارمزد</th>
                                <th >fixed.amount</th>
                                <th transloco *ngIf="feeTypeId!='2'&&feeTypeId!='1'">percentage</th>

                                <th transloco *ngIf="wageTypeFlag&&!wageTedadiFlag&&!sadehFlag">from.amount</th>
                                <th transloco *ngIf="wageTypeFlag&&!wageTedadiFlag&&!sadehFlag">to.amount</th>

                                <th transloco *ngIf="wageTedadiFlag">از تعداد</th>
                                <th transloco *ngIf="wageTedadiFlag">تا تعداد</th>

                                <th transloco >min.fee.amount</th>
                                <th transloco >max.fee.amount</th>
                                <!--                                <th >حداقل مبلغ کارمزد</th>-->
                                <!--                                <th >حداکثر مبلغ کارمزد</th>-->
                                <th style="text-align: right !important;border-right: 1px solid #ebe8e8;" >
                                    operation
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-wage let-i="rowIndex">
                            <tr>
                                <td>{{i + 1}}</td>
                                <td>{{wage.title}}</td>
                                <td >{{wage.feeTypeId|wageType}}</td>
                                <td >{{ wage.calculationTypeId == '1'?(wage.calculationValue |addCommaSeparator): 0}}</td>
                                <td *ngIf="feeTypeId!='2'&&feeTypeId!='1'">{{wage.calculationTypeId == '2' ? (wage.calculationValue| addcaracterpipe:'%') : 0}}</td>

                                <td *ngIf="wageTypeFlag&&!wageTedadiFlag&&!sadehFlag">{{wage.feeTypeId == '2' ? (wage.fromValue |addCommaSeparator) : wage.fromValue}}</td>
                                <td *ngIf="wageTypeFlag&&!wageTedadiFlag&&!sadehFlag">{{wage.feeTypeId == '2' ? (wage.toValue|addCommaSeparator) : wage.toValue}}</td>



                                <td *ngIf="wageTedadiFlag">{{wage.feeTypeId == '3' ? (wage.fromValue|addCommaSeparator) : wage.fromValue}}</td>
                                <td *ngIf="wageTedadiFlag">{{wage.feeTypeId == '3' ? (wage.toValue|addCommaSeparator) : wage.toValue}}</td>

                                <td >{{(wage.feeTypeId == '1' || wage.feeTypeId == '2' || wage.feeTypeId == '3') ?
                                    (wage.minValue|addCommaSeparator) :wage.minValue }}</td>
                                <td >{{(wage.feeTypeId == '1' || wage.feeTypeId == '2' || wage.feeTypeId == '3')
                                    ? (wage.maxvalue|addCommaSeparator) : wage.maxvalue}}</td>
                                <!--                                <td>{{wage.feeTypeId == '3' ? (wage.minValue|addCommaSeparator) : 0}}</td>-->
                                <!--                                <td>{{wage.feeTypeId == '3' ? (wage.maxvalue|addCommaSeparator) : 0}}</td>-->
                                <td class="text-right border-r border-[#ebe8e8]" >
                                    <button [disabled]="disableUpdateFlag" (click)="setRecord(wage);menu.toggle($event)" type="button"
                                            class="p-button-rounded  " pButton
                                            pRipple icon="pi pi-chevron-down" ></button>&nbsp;
                                    <p-tieredMenu appendTo="body" #menu [popup]="true" [model]="items">
                                    </p-tieredMenu>
                                </td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
                <div class="col-4"></div>
                <div class="col-4"></div>
            </div>
        </p-panel>
        <div dir="ltr" style="margin-top: 15px">
            <button pButton label="{{'button.cancel' | transloco}}"
                     severity="danger"  icon="pi pi-times"  [outlined]="true"
                    (click)="onCancel()"></button>&nbsp;
            <button pButton severity="success" label="{{'ثبت اطلاعات' | transloco}}" icon="pi pi-save"
                    (click)="onRegister()" [hidden]="disableUpdateFlag"></button>
        </div>
    </p-panel>

</div>
<p-dialog [style]="{'width':'55%'}" [(visible)]="dialogApisFlag"
          [modal]="true" [draggable]="false" appendTo="body"
          [resizable]="true">
    <p-panel header="{{'سرویس ها' | transloco}}">
        <div class="grid grid-cols-12">
            <div class="col-12">
                <p-table selectionMode="single" [value]="apiList"
                         [paginator]="true" [rows]="rows" [showCurrentPageReport]="true" [(first)]="first"
                         [currentPageReportTemplate]=paginationLabel
                         [rowsPerPageOptions]="[5,10,25,50,100]">
                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="row" class="row" >
                                row
                                <p-sortIcon field="row"></p-sortIcon>
                            </th>
                            <th pSortableColumn="title" class="title" >
                                عنوان سرویس
                                <p-sortIcon field="title"></p-sortIcon>
                            </th>
                            <th pSortableColumn="name" class="name" >
                                نام سرویس
                                <p-sortIcon field="name"></p-sortIcon>
                            </th>
                            <th pSortableColumn="status" class="status" >
                                وضعیت
                                <p-sortIcon field="status"></p-sortIcon>
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template let-i="rowIndex" pTemplate="body" let-api>
                        <tr [pSelectableRow]="api">
                            <td class="row">{{api.row}}</td>
                            <td class="title"
                                [pTooltip]="api.title"
                                [tooltipDisabled]="api.title?api.title.length < 50:false"
                            >
                                {{api.title|moreCharLong}}
                            </td>
                            <td class="name"
                                [pTooltip]="api.name"
                                [tooltipDisabled]="api.name?api.name.length < 50:false"
                            >
                                {{api.name|moreCharLong}}
                            </td>
                            <td class="status" [ngStyle]="{'text-align': 'center !important'}">
                                <div [ngStyle]="{ 'border-radius':' 2.5px','color':api.status == true ?
                         '#258F30' :'#962515',
                         'background-color': api.status == false ?'#F18B7D' : '#85DC8F',
                         'width':'45px','margin':' 0 auto'}">
                                    {{api.status|statusPipe}}</div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </p-panel>
</p-dialog>
<p-dialog [style]="{'width':'50%'}" [(visible)]="helpFlag"
          [modal]="true" [draggable]="false" appendTo="body" header="توجه!!!"
          [resizable]="true">
    <div disabled class="red-color-text">
        <span>
- با تغییر نوع کارمزد دیتای شما از دست خواهد رفت، لطفا در تغییر نوع کارمزد دقت فرمائید!
        </span>
        <br>
        <br>
        <span>
- جهت ثبت کارمزد مبلغی پلکانی لازم به ذکر  هست که حتما باید فیلد محاسبه گر کارمزد در بخش سرویس برای سرویس مورد نظر ثبت شده باشد!
        </span>
    </div>
    <br>
    <div class="col-12" dir="ltr" style="margin-top: 15px">
        <button type="button" pButton  severity="danger"  label="بستن" class="normal-button" icon="pi pi-times" (click)="helpFlag=false"></button>
    </div>
</p-dialog>
