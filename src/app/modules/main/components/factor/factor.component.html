<p-toast />
<app-breadcrumbs id="section"></app-breadcrumbs>
<div class="grid flex-column">
    <p-panel header="{{'فاکتور'}}" *ngIf="!addFlag&&!updateFlag">
        <div class=" grid">
            <div class="col-12">
                <div class="grid grid-cols-12">
                    <div class="col-4">
                        <label class="normal-label">
<span class="red-color-text">* </span>
<span >نام سازمان :</span></label><br>
                        <p-dropdown
                            (keydown.enter)="onKeydown($event)"
                            appendTo="body"
                            [options]="partyListOptions"
                            [(ngModel)]="partyId"
                            optionValue="partyId"
                            [filter]="true"
                            filterBy="title"
                            optionLabel="title"
                            (onChange)="OnchangeParty($event)">
                        </p-dropdown>
                    </div>
                    <div class="col-8" dir="ltr">
                        <button pButton label="{{'جستجو'}}"
                                style="width: 110px;margin: 3px;margin-top: 20px"
                                class="btnSearch btnSearchModoule" icon="pi pi-search"
                                (click)="search()"></button>&nbsp;&nbsp;
                        <button pButton label="{{'button.clear'|transloco}}"  class="my-1 px-4 py-2 border normal-button"
                                [outlined]="true" icon="pi pi-filter-slash"
                                 (click)="clear()"></button>
                    </div>
                    <div class="col-8"></div>
                </div>
            </div>
            <div class="col-12" *ngIf="!addFlag&&!updateFlag">
                <button pButton label="{{'ایجاد فاکتور'}}"
                        icon="pi pi-plus" (click)="showAdd()"></button>
            </div>

        </div>
        <p-table [value]="factorList" selectionMode="single" *ngIf="!addFlag&&!updateFlag"
                 [paginator]="true" [rows]="rows" [showCurrentPageReport]="true" [(first)]="first"
                 [currentPageReportTemplate]=paginationLabel
                 [rowsPerPageOptions]="[5,10,25,50,100]">
            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="row" class="row" >
                        table.header.row
                        <p-sortIcon field="row"></p-sortIcon>
                    </th>
                    <th pSortableColumn="partyTitle" class="partyTitle" >
                        نام سازمان
                        <p-sortIcon field="partyTitle"></p-sortIcon>
                    </th>
                    <th pSortableColumn="billAmount" class="billAmount" >
                        مبلغ صورت حساب
                        <p-sortIcon field="billAmount"></p-sortIcon>
                    </th>
                    <th pSortableColumn="billTotall" class="billTotall" >
                        مبلغ قابل پرداخت
                        <p-sortIcon field="billTotall"></p-sortIcon>
                    </th>
                    <th pSortableColumn="fromDate" class="fromDate" >
                        از تاریخ
                        <p-sortIcon field="fromDate"></p-sortIcon>
                    </th>
                    <th pSortableColumn="toDate" class="toDate" >
                        تا تاریخ
                        <p-sortIcon field="toDate"></p-sortIcon>
                    </th>
                    <th pSortableColumn="billStatus" class="billStatus" >
                        وضعیت
                        <p-sortIcon field="billStatus"></p-sortIcon>
                    </th>
                    <th style="text-align: right !important;border-right: 1px solid #ebe8e8;" >operation
                    </th>
                </tr>
            </ng-template>
            <ng-template let-i="rowIndex" pTemplate="body" let-factor>
                <tr [pSelectableRow]="factor">
                    <td class="row">{{factor.row}}</td>
                    <td class="partyTitle"
                        [pTooltip]="factor.partyTitle"
                        [tooltipDisabled]="factor.partyTitle?factor.partyTitle.length < 20:false"
                    >
                        {{factor.partyTitle|moreChar19}}
                    </td>
                    <td class="billAmount"
                        [pTooltip]="factor.billAmount"
                        [tooltipDisabled]="factor.billAmount?factor.billAmount.toString().length < 20:false">
                        {{factor.billAmount|addCommaSeparator}}
                    </td>
                    <td class="billTotall"
                        [pTooltip]="factor.billTotall"
                        [tooltipDisabled]="factor.billTotall?factor.billTotall.toString().length < 20:false">
                        {{factor.billTotall|addCommaSeparator}}
                    </td>
                    <td class="fromDate">
                        {{factor.fromDate|castToDate}}
                    </td>
                    <td class="toDate">
                        {{factor.toDate|castToDate}}
                    </td>
                    <td class="billStatus" [ngStyle]="{'text-align': 'center !important'}">
                        <div [ngStyle]="{ 'border-radius':' 2.5px','color':factor.billStatus == 3 ?
                         '#258F30' :'#966224',
                         'background-color': factor.billStatus == 1 ?'#F1D87B' : '#85DC8F',
                         'width':'70px','margin':' 0 auto'}">
                            {{factor.billStatus|billStatus}}</div>
                    </td>
                    <td class="text-right border-r border-[#ebe8e8]" >
                        <button (click)="setRecord(factor)" type="button" class="p-button-rounded  "
                                pButton
                                pRipple icon="pi pi-chevron-down" (click)="menu.toggle($event)"></button>&nbsp;
                        <p-menu appendTo="body" #menu [popup]="true" [model]="items"></p-menu>
                    </td>

                </tr>
            </ng-template>
        </p-table>
    </p-panel>
    <div class="col-12" *ngIf="addFlag">
        <app-factor-register (close)="onClose($event)" [factorObj]="factorObj"></app-factor-register>
    </div>
</div>
